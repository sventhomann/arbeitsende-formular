<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Arbeitsende Formular</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 2em;
    }
    label {
      display: block;
      margin-top: 1em;
    }
    input, textarea, select {
      width: 100%;
      padding: 0.5em;
      margin-top: 0.2em;
    }
    #bauherren-teil {
      display: none;
    }
  </style>
</head>
<body>
  <form id="handwerker-form" action="https://htwg.walz40.eu/webhook-test/arbeitsende-senden" method="POST">
    <h2>Arbeitsende Formular (Handwerker)</h2>

    <label for="firma">Firma</label>
    <select name="firma" id="firma" required>
      <option value="">Bitte auswählen</option>
      <option value="Zimmerei XY">Zimmerei XY</option>
      <option value="Rohbauer XY">Rohbauer XY</option>
      <option value="Trockenbauer XY">Trockenbauer XY</option>
      <option value="Gipser XY">Gipser XY</option>
      <option value="Estrichleger XY">Estrichleger XY</option>
      <option value="Maler XY">Maler XY</option>
      <option value="Dachdecker XY">Dachdecker XY</option>
      <option value="Bodenleger XY">Bodenleger XY</option>
      <option value="Fliesenleger XY">Fliesenleger XY</option>
      <option value="HLS XY">HLS XY</option>
    </select>

    <label for="name">Name</label>
    <input type="text" name="name" id="name" required />

    <label for="beschreibung">Tätigkeit</label>
    <textarea name="beschreibung" id="beschreibung" rows="5" required></textarea>

    <label for="bilder">Bilder</label>
    <input type="file" name="bilder" id="bilder" multiple />

    <button type="submit">Absenden</button>
  </form>

  <div id="bauherren-teil">
    <h2>Bearbeitung durch Bauherren</h2>

    <label for="startzeit">Startzeit</label>
    <input type="text" name="startzeit" id="startzeit" readonly />

    <label for="endzeit">Endzeit</label>
    <input type="text" name="endzeit" id="endzeit" readonly />

    <label for="arbeitsdauer">Dauer</label>
    <input type="text" name="arbeitsdauer" id="arbeitsdauer" readonly />

    <label for="entscheidung">Entscheidung</label>
    <select name="entscheidung" id="entscheidung" required onchange="toggleBauherrenFields()">
      <option value="">Bitte auswählen</option>
      <option value="akzeptiert">Akzeptiert</option>
      <option value="akzeptiert_mit_aenderungen">Akzeptiert mit Änderungen</option>
      <option value="abgelehnt">Abgelehnt</option>
    </select>

    <div id="feld-bemerkung" style="display:none;">
      <label for="bemerkung">Bemerkungen</label>
      <textarea name="bemerkung" id="bemerkung" rows="4"></textarea>
    </div>

    <div id="feld-geaenderte-dauer" style="display:none;">
      <label for="geaenderte_dauer">Geänderte Arbeitsdauer</label>
      <input type="text" name="geaenderte_dauer" id="geaenderte_dauer" />
    </div>

    <div id="feld-ablehnung" style="display:none;">
      <label for="grund_ablehnung">Grund der Ablehnung</label>
      <textarea name="grund_ablehnung" id="grund_ablehnung" rows="4" required></textarea>
    </div>

    <button type="submit">Antwort absenden</button>
  </div>

  <script>
    function toggleBauherrenFields() {
      const entscheidung = document.getElementById("entscheidung").value;
      document.getElementById("feld-bemerkung").style.display = (entscheidung === "akzeptiert" || entscheidung === "akzeptiert_mit_aenderungen") ? "block" : "none";
      document.getElementById("feld-geaenderte-dauer").style.display = (entscheidung === "akzeptiert_mit_aenderungen") ? "block" : "none";
      document.getElementById("feld-ablehnung").style.display = (entscheidung === "abgelehnt") ? "block" : "none";
    }

    window.addEventListener('DOMContentLoaded', () => {
      const urlParams = new URLSearchParams(window.location.search);
      const rolle = urlParams.get('rolle');
      const startzeit = urlParams.get('startzeit');
      const endzeit = urlParams.get('endzeit');
      const dauer = urlParams.get('dauer');

      if (rolle === 'bauherr') {
        // Bauherren-Teil einblenden
        const bauherrenTeil = document.getElementById('bauherren-teil');
        if (bauherrenTeil) {
          bauherrenTeil.style.display = 'block';
        }

        // Handwerker-Teil ausblenden
        const handwerkerForm = document.getElementById('handwerker-form');
        if (handwerkerForm) {
          handwerkerForm.style.display = 'none';
        }

        // Werte setzen
        if (startzeit) document.getElementById('startzeit').value = decodeURIComponent(startzeit);
        if (endzeit) document.getElementById('endzeit').value = decodeURIComponent(endzeit);
        if (dauer) document.getElementById('arbeitsdauer').value = decodeURIComponent(dauer);
      }
    });
  </script>
</body>
</html>

